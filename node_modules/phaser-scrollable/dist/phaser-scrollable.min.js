/*! phaser-scrollable 14-01-2018 */

var ScrollableArea=function(t,i,s,e,h){h=h||{},Phaser.Group.call(this,game),this._x=this.x=t,this._y=this.y=i,this._w=s,this._h=e,this.maskGraphics=game.add.graphics(t,i),this.maskGraphics.beginFill(0),this.maskGraphics.drawRect(0,0,s,e),this.maskGraphics.alpha=.2,this.maskGraphics.inputEnabled=!0,this.mask=this.maskGraphics,this.dragging=!1,this.pressedDown=!1,this.timestamp=0,this.callbackID=0,this.targetX=0,this.targetY=0,this.autoScrollX=!1,this.autoScrollY=!1,this.inputX=0,this.inputY=0,this.startX=0,this.startY=0,this.velocityX=0,this.velocityY=0,this.amplitudeX=0,this.amplitudeY=0,this.directionWheel=0,this.velocityWheelX=0,this.velocityWheelY=0,this.settings={kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!0,deltaWheel:40,clickXThreshold:5,clickYThreshold:5},this.configure(h),this.addChild=function(t){this.maskGraphics.x=this.parent.x+this._x,this.maskGraphics.y=this.parent.y+this._y,ScrollableArea.prototype.addChild.call(this,t)}};ScrollableArea.prototype=Object.create(Phaser.Group.prototype),ScrollableArea.prototype.constructor=ScrollableArea,ScrollableArea.prototype.configure=function(t){if(t)for(var i in t)this.settings.hasOwnProperty(i)&&null!=this.settings[i]&&(this.settings[i]=t[i])},ScrollableArea.prototype.start=function(){this.game.input.onDown.add(this.beginMove,this),this.callbackID=this.game.input.addMoveCallback(this.moveCanvas,this),this.game.input.onUp.add(this.endMove,this),this.game.input.mouse.mouseWheelCallback=this.mouseWheel.bind(this)},ScrollableArea.prototype.beginMove=function(){this.allowScrollStopOnTouch&&this.scrollTween&&this.scrollTween.pause(),this.maskGraphics.getBounds().contains(this.game.input.x,this.game.input.y)?(this.startedInside=!0,this.startX=this.inputX=this.game.input.x,this.startY=this.inputY=this.game.input.y,this.pressedDown=!0,this.timestamp=Date.now(),this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0):this.startedInside=!1},ScrollableArea.prototype.moveCanvas=function(t,i,s){if(this.pressedDown){this.now=Date.now();var e,h=this.now-this.timestamp;if(this.timestamp=this.now,this.settings.horizontalScroll)0!==(e=i-this.startX)&&(this.dragging=!0),this.startX=i,this.velocityX=1e3*e/(1+h)*.8+.2*this.velocityX,this.x+=e;if(this.settings.verticalScroll)0!==(e=s-this.startY)&&(this.dragging=!0),this.startY=s,this.velocityY=1e3*e/(1+h)*.8+.2*this.velocityY,this.y+=e;this.limitMovement()}},ScrollableArea.prototype.endMove=function(){if(this.startedInside){if(this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,!this.settings.kineticMovement)return;if(this.now=Date.now(),this.game.input.activePointer.withinGame&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(this.x+this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.y+this.amplitudeY),this.autoScrollY=!0)),this.game.input.activePointer.withinGame||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollY=!0)),Math.abs(game.input.x-this.inputX)<=this.settings.clickXThreshold&&Math.abs(game.input.y-this.inputY)<=this.settings.clickYThreshold)for(var t=0;t<this.children.length;t++)this.getChildAt(t).getBounds().contains(game.input.x,game.input.y)&&this.getChildAt(t).inputEnabled&&this.getChildAt(t).events.onInputUp.getNumListeners()>0&&this.getChildAt(t).events.onInputUp.dispatch()}},ScrollableArea.prototype.scrollTo=function(t,i,s,e,h){this.scrollTween&&this.scrollTween.pause(),t=t>0?-t:t,i=i>0?-i:i,e=e||Phaser.Easing.Quadratic.Out,s=s||1e3,h=h||!1,this.allowScrollStopOnTouch=h,this.scrollTween=game.add.tween(this),this.scrollTween.to({x:t,y:i},s,e).start()},ScrollableArea.prototype.update=function(){var t;(this.elapsed=Date.now()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.autoScrollX&&0!=this.amplitudeX)&&((t=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll))>.5||t<-.5?this.x=this.targetX+t:this.autoScrollX=!1);this.autoScrollY&&0!=this.amplitudeY&&((t=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll))>.5||t<-.5?this.y=this.targetY+t:this.autoScrollY=!1);this.autoScrollX||this.autoScrollY||(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,this.x+=this.velocityWheelX,this.velocityWheelX*=.95),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,this.y+=this.velocityWheelY,this.velocityWheelY*=.95),this.limitMovement()},ScrollableArea.prototype.mouseWheel=function(t){if(this.settings.horizontalWheel||this.settings.verticalWheel){t.preventDefault();var i=120*this.game.input.mouse.wheelDelta/this.settings.deltaWheel;this.directionWheel!=this.game.input.mouse.wheelDelta&&(this.velocityWheelX=0,this.velocityWheelY=0,this.directionWheel=this.game.input.mouse.wheelDelta),this.settings.horizontalWheel&&(this.autoScrollX=!1,this.velocityWheelX+=i),this.settings.verticalWheel&&(this.autoScrollY=!1,this.velocityWheelY+=i)}},ScrollableArea.prototype.stop=function(){this.game.input.onDown.remove(this.beginMove,this),this.callbackID?this.game.input.deleteMoveCallback(this.callbackID):this.game.input.deleteMoveCallback(this.moveCanvas,this),this.game.input.onUp.remove(this.endMove,this),this.game.input.mouse.mouseWheelCallback=null},ScrollableArea.prototype.setPosition=function(t){t.x&&(this.x+=t.x-this._x,this.maskGraphics.x=this._x=t.x),t.y&&(this.y+=t.y-this._y,this.maskGraphics.y=this._y=t.y)},ScrollableArea.prototype.limitMovement=function(){this.settings.horizontalScroll&&(this.x>this._x&&(this.x=this._x),this.x<-(this.width-this._w-this._x)&&(this.width>this._w?this.x=-(this.width-this._w-this._x):this.x=this._x)),this.settings.verticalScroll&&(this.y>this._y&&(this.y=this._y),this.y<-(this.height-this._h-this._y)&&(this.height>this._h?this.y=-(this.height-this._h-this._y):this.y=this._y))};